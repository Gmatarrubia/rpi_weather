---
- name: Ansible playbook for installing the flutter
  hosts: localhost
  vars:
    is_WSL: "{{ ansible_kernel.find('WSL') }}"
  tasks:
    - name: Check flutter resources
      ansible.builtin.stat:
        path: /opt/flutter/bin
      register: p
    - name: Get Flutter sources
      when: not p.stat.exists
      ansible.builtin.git:
        repo: https://github.com/flutter/flutter.git
        dest: /opt/flutter
        version: stable

    - name: Download flutter precache
      command: /opt/flutter/bin/flutter precache
    - name: Disable flutter analytics
      command: /opt/flutter/bin/flutter config --no-analytics
    - name: Download flutter precache
      command: /opt/flutter/bin/dart --disable-analytics
    - name: Enable Flutter for linux
      command: flutter config --enable-linux-desktop

    - name: Set vncserver config
      when: is_WSL != -1
      ansible.builtin.copy:
        dest: ~/.vnc/tightvncserver.conf
        content: |
          geometry = "800x480";
          depth = 24;
          SecurityTypes = "None";
          localhost = "yes";

    - name: Enable and star vncserver in case of WSL
      when: is_WSL != -1
      command: tigervncserver -useold -noxstartup -SecurityTypes None -localhost yes :1